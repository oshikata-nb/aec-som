CREATE OR REPLACE VIEW REP_DEL_DATE_CONTACT_HEADER
    (KEY,FRST_ORDER_NO,FRST_ORDER_ROW_NO,VENDER_CD,VENDER_NAME,VENDER_FULL_ADDRESS_1,
    VENDER_FULL_ADDRESS_2,VENDER_TEL_NO,VENDER_FAX_NO,CTM_VENDER_CD,CTM_VENDER_NAME,
    DELIVERY_CD,DELIVERY_NAME,DELIVERY_FULL_ADDRESS_1,DELIVERY_FULL_ADDRESS_2,
    DELIVERY_ADDRESS,DELIVERY_TEL_NO,DELIVERY_FAX_NO,CTM_DELIVERY_CD,CTM_DELIVERY_NAME,
    CTM_DELIVERY_FULL_ADDRESS,CTM_DELIVERY_TEL_NO,CTM_DELIVERY_FAX_NO,CTM_DELIVERY_ZIP_CD,
    CTM_ORDER_NO,CTM_ORDER_DATE,DELIVERY_EXPECTED_DATE,SALES_TANTO_CD,SALES_TANTO_NAME,
    ORDER_NO,CARRY_CD,CARRY_NAME,CARRY_FARE,PRINT_SUMMERY,DELIVERY_SLIP_SUMMERY,
    SCHEDULED_SHIPPING_DATE,INPUT_DIVISION,ORDER_GROUP_NO,SHIPPING_NO,UPDATE_DATE,
    ORG_ZIPCODE,ORG_ADDRESS,ORG_TEL_NO,ORG_FAX_NO,SEC_VENDER_CD,THI_VENDER_CD,
    FOU_VENDER_CD,FIF_VENDER_CD,DELIVERY_EXPECTED_TIME,DELIVERYDATE_CONTACT_SUMMERY)
AS
SELECT DISTINCT
      FRST_ORDER_HEAD.FRST_ORDER_NO AS KEY
  ,   FRST_ORDER_HEAD.FRST_ORDER_NO
  ,   FRST_ORDER_DETAIL.FRST_ORDER_ROW_NO
  ,   FRST_ORDER_HEAD.VENDER_CD
  ,   VEN.VENDER_NAME1 || VEN.VENDER_NAME2 VENDER_NAME
  ,   VEN.ADDRESS1 || VEN.ADDRESS2 VENDER_FULL_ADDRESS_1
  ,   VEN.ADDRESS3 VENDER_FULL_ADDRESS_2
  ,   VEN.TEL_NO VENDER_TEL_NO
  ,   VEN.FAX_NO VENDER_FAX_NO
  ,   OI.CTM_VENDER_CD_01 || OI.CTM_VENDER_CD_02 || OI.CTM_VENDER_CD_03 CTM_VENDER_CD
  ,   OI.CTM_VENDER_NAME_01 || OI.CTM_VENDER_NAME_02 || OI.CTM_VENDER_NAME_03 CTM_VENDER_NAME
  ,   FRST_ORDER_HEAD.DELIVERY_CD
  ,   DEL.DELIVERY_NAME1 || DELIVERY_NAME2 DELIVERY_NAME
  ,   DEL.ADDRESS1 || DEL.ADDRESS2 DELIVERY_FULL_ADDRESS_1
  ,   DEL.ADDRESS3 DELIVERY_FULL_ADDRESS_2
  ,   FRST_ORDER_HEAD.DELIVERY_ADDRESS || CASE WHEN NVL(LENGTH(TRIM(FRST_ORDER_HEAD.DELIVERY_ADDRESS)),0) > 0 THEN '様' END AS DELIVERY_ADDRESS
  ,   CASE WHEN REPLACE(REPLACE(FRST_ORDER_HEAD.DELIVERY_TEL_NO,'　',''),' ','') IS NOT NULL THEN FRST_ORDER_HEAD.DELIVERY_TEL_NO ELSE DEL.TEL_NO END AS DELIVERY_TEL_NO
  ,   DEL.FAX_NO DELIVERY_FAX_NO
  ,   OI.CTM_DELIVERY_CD_01 || OI.CTM_DELIVERY_CD_02 || OI.CTM_DELIVERY_CD_03 CTM_DELIVERY_CD
  ,   OI.CTM_DELIVERY_NAME_01 || OI.CTM_DELIVERY_NAME_02 || OI.CTM_DELIVERY_NAME_03 CTM_DELIVERY_NAME
  ,   OI.CTM_DELIVERY_ADDRESS_01 || OI.CTM_DELIVERY_ADDRESS_02 || OI.CTM_DELIVERY_ADDRESS_03 CTM_DELIVERY_FULL_ADDRESS
  ,   OI.CTM_DELIVERY_TEL_NO
  ,   OI.CTM_DELIVERY_FAX_NO
  ,   OI.CTM_DELIVERY_ZIP_CD
  ,   FRST_ORDER_HEAD.CUSTOMER_ORDER_NO AS CTM_ORDER_NO
  ,   NVL(OI.CTM_ORDER_DATE, FRST_ORDER_HEAD.ORDER_DATE) CTM_ORDER_DATE
  ,   CASE WHEN FRST_ORDER_HEAD.ORDER_DIVISION = 3 THEN PURCHASE_SUBCONTRACT.SUGGESTED_DELIVERLIMIT_DATE ELSE FRST_ORDER_HEAD.DELIVERY_EXPECTED_DATE END AS DELIVERY_EXPECTED_DATE
  ,   FRST_ORDER_HEAD.SALES_TANTO_CD
  ,   SAL_NM.TANTO_NM SALES_TANTO_NAME
  ,   NVL( FRST_ORDER_HEAD.ORDER_NO , FRST_ORDER_HEAD.FRST_ORDER_NO ) AS ORDER_NO
  ,   FRST_ORDER_HEAD.CARRY_CD
  ,   CRY.ABBREVIATION CARRY_NAME
  ,   FRST_ORDER_HEAD.CARRY_FARE
  ,   FRST_ORDER_HEAD.PRINT_SUMMERY
  ,   FRST_ORDER_HEAD.DELIVERY_SLIP_SUMMERY
  ,   CASE WHEN FRST_ORDER_HEAD.ORDER_DIVISION = 3 THEN NULL ELSE FRST_ORDER_HEAD.SCHEDULED_SHIPPING_DATE END AS SCHEDULED_SHIPPING_DATE
  ,   NULL AS INPUT_DIVISION
  ,   NULL AS ORDER_GROUP_NO
  ,   SHIPPING.SHIPPING_NO
  ,   FRST_ORDER_HEAD.UPDATE_DATE
  ,   ORG.ZIPCODE_NO AS ORG_ZIPCODE
  ,   ORG.ADDRESS1 || ORG.ADDRESS2 || ORG.ADDRESS3 AS  ORG_ADDRESS
  ,   'TEL:' || ORG.TEL_NO AS ORG_TEL_NO
  ,   'FAX:' || ORG.FAX_NO AS ORG_FAX_NO
  ,   FNC_GET_UPPER_VENDER(FRST_ORDER_HEAD.BALANCE_CD,2) AS SEC_VENDER_CD
  ,   FNC_GET_UPPER_VENDER(FRST_ORDER_HEAD.BALANCE_CD,3) AS THI_VENDER_CD
  ,   FNC_GET_UPPER_VENDER(FRST_ORDER_HEAD.BALANCE_CD,4) AS FOU_VENDER_CD
  ,   FNC_GET_UPPER_VENDER(FRST_ORDER_HEAD.BALANCE_CD,5) AS FIF_VENDER_CD
  ,   FRST_ORDER_HEAD.DELIVERY_EXPECTED_TIME 
  ,   FRST_ORDER_HEAD.DELIVERYDATE_CONTACT_SUMMERY
  FROM FRST_ORDER_HEAD
  LEFT JOIN FRST_ORDER_DETAIL ON FRST_ORDER_HEAD.FRST_ORDER_NO = FRST_ORDER_DETAIL.FRST_ORDER_NO
  LEFT JOIN VENDER VEN ON FRST_ORDER_HEAD.VENDER_CD = VEN.VENDER_CD
  LEFT JOIN ORGANIZATION ORG ON VEN.ORGANIZATION_CD = ORG.ORGANIZATION_CD
  LEFT JOIN DELIVERY DEL ON FRST_ORDER_HEAD.DELIVERY_CD = DEL.DELIVERY_CD
  LEFT JOIN LOGIN SAL_NM ON FRST_ORDER_HEAD.SALES_TANTO_CD = SAL_NM.TANTO_CD
  LEFT JOIN CARRY CRY ON FRST_ORDER_HEAD.CARRY_CD = CRY.CARRY_CD
  LEFT JOIN (SELECT
                  PURCHASE_SUBCONTRACT.ORDER_NO
                  ,PURCHASE_SUBCONTRACT.ORDER_ROW_NO
                  ,PURCHASE_SUBCONTRACT.STATUS
                  ,PURCHASE_SUBCONTRACT.SUGGESTED_DELIVERLIMIT_DATE
              FROM PURCHASE_SUBCONTRACT
              WHERE ORDER_NO IS NOT NULL
              GROUP BY                 PURCHASE_SUBCONTRACT.ORDER_NO
                  ,PURCHASE_SUBCONTRACT.ORDER_ROW_NO
                  ,PURCHASE_SUBCONTRACT.STATUS
                  ,PURCHASE_SUBCONTRACT.SUGGESTED_DELIVERLIMIT_DATE
  ) PURCHASE_SUBCONTRACT ON PURCHASE_SUBCONTRACT.ORDER_NO = FRST_ORDER_DETAIL.ORDER_NO AND PURCHASE_SUBCONTRACT.ORDER_ROW_NO = FRST_ORDER_DETAIL.ROW_NO
  LEFT JOIN SHIPPING ON SHIPPING.ORDER_NO = FRST_ORDER_DETAIL.ORDER_NO AND SHIPPING.ORDER_ROW_NO = FRST_ORDER_DETAIL.ROW_NO
  LEFT JOIN ORDER_IMP_BASE OI ON OI.ORDER_IMP_NO = FRST_ORDER_DETAIL.ORDER_IMP_NO
  WHERE FRST_ORDER_HEAD.DEL_FLG <> 1 AND FRST_ORDER_DETAIL.DEL_FLG <> 1
/
COMMENT ON TABLE REP_DEL_DATE_CONTACT_HEADER IS 'REP_納期連絡表ヘッダ'
/

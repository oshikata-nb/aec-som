CREATE OR REPLACE VIEW REP_SLIP_SHIPPING_DEL_HEADER
    (KEY,SHIPPING_NO,CATEGORY_DIVISION,VENDER_CD,VENDER_NAME,DELIVERY_NAME_ALL,
    DELIVERY_ADDRESS_ALL,DELIVERY_TEL_NO,DELIVERY_CD,SHIPPING_INSTRUCT_DATE,
    SCHEDULED_SHIPPING_DATE,TANTO_CD,DELIVERY_EXPECTED_DATE,DELIVERY_EXPECTED_TIME,
    UPPER_LOCATION_CD,LOCATION_NAME,CARRY_CD,CARRY_NAME1,CARRY_NAME2,REFERENCE,
    CUSTOMER_ORDER_NO,ORDER_NO,ORDER_ROW_NO,SHIPPING_STATUS,ITEM_CD,DELIVERY_COMP,
    SHIPPING_RESULT_DATE,SHIPPING_SLIP_NO,SHIPPING_SLIP_ROW_NO,SLIP_PUBLISH_COMP,
    SLIP_PUBLISH_DATE,SLIP_SHIPPING_ORDER_COMP,SLIP_SHIPPING_ORDER_DATE,
    SLIP_SHIPPING_SCHEDULE_COMP,SLIP_SHIPPING_SCHEDULE_DATE,SLIP_SHIPPING_TAG_COMP,
    SLIP_SHIPPING_TAG_DATE,SLIP_SHIPPING_REQUEST_COMP,SLIP_SHIPPING_REQUEST_DATE,
    SLIP_SHIPPING_FARE_COMP,SLIP_SHIPPING_FARE_DATE,SLIP_SHIPPING_DELIVELY_COMP,
    SLIP_SHIPPING_DELIVELY_DATE,SLIP_SHIPPING_NEW_TAG_COMP,SLIP_SHIPPING_NEW_TAG_DATE,
    SLIP_SHIPPING_POSTAL_COMP,SLIP_SHIPPING_POSTAL_DATE,SUGGESTED_DELIVERLIMIT,
    CARRY_FARE,SENDING_OFF_NUMBER,INPUT_DATE,INPUTOR_CD,UPDATE_DATE,UPDATOR_CD,
    FAX_NO,FAX_OUTPUT,REPOTR_OUTPUT_NUM,PRINT_SUMMERY,DELIVERY_SLIP_SUMMERY,
    ORDER_SUMMERY,CARRY_BARCODE,BC_PUBLISH_DIVISION,BC_HEADER,BC_FOOTER,
    BC_NUMBER_OF_DIGIT,BC_CHECKDIGIT_START,BC_CHECKDIGIT_END)
AS
SELECT   SHIPPING.CARRY_CD || TO_CHAR(SHIPPING.SCHEDULED_SHIPPING_DATE,'YYYYMMDD') || SHIPPING_DETAIL_LOCATION.UPPER_LOCATION_CD || SHIPPING.ORDER_NO || ORDER_HEAD.CUSTOMER_ORDER_NO || SHIPPING.VENDER_CD || SHIPPING.DELIVERY_CD || SHIPPING.CARRY_BC  AS KEY-- キー
--SHIPPING.CARRY_CD || SHIPPING.VENDER_CD || SHIPPING.DELIVERY_CD || TO_CHAR(SHIPPING.SCHEDULED_SHIPPING_DATE,'YYYYMMDD') || SHIPPING_DETAIL_LOCATION.UPPER_LOCATION_CD || ORDER_HEAD.CUSTOMER_ORDER_NO || SHIPPING.ORDER_NO AS KEY-- キー
        ,SHIPPING.SHIPPING_NO -- キー

        ,'売上' AS CATEGORY_DIVISION
        ,SHIPPING.VENDER_CD
        ,FNC_GET_VENDER_NAME(SHIPPING.ORDER_NO,SHIPPING.DELIVERY_CD) VENDER_NAME -- お得意先名
        ,(CASE WHEN 
                    SHIPPING.DELIVERY_CD IS NOT NULL
               THEN 
                    DELIVERY.DELIVERY_NAME1 || ' ' || DELIVERY.DELIVERY_NAME2 || ' ' || ORDER_HEAD.DELIVERY_ADDRESS
		       ELSE
			        NULL
	      END) AS DELIVERY_NAME_ALL--お届先名
          ,DELIVERY.ADDRESS1 || ' '  || DELIVERY.ADDRESS2 || ' '  || DELIVERY.ADDRESS3 AS DELIVERY_ADDRESS_ALL -- お届先住所
        ,(CASE WHEN 
                    ORDER_HEAD.DELIVERY_TEL_NO IS NULL
		       THEN 
			        DELIVERY.TEL_NO
		       ELSE 
			        ORDER_HEAD.DELIVERY_TEL_NO
	      END) AS DELIVERY_TEL_NO -- ＴＥＬ
        ,SHIPPING.DELIVERY_CD -- 届先コード
        ,SHIPPING.SHIPPING_INSTRUCT_DATE
        ,TO_CHAR(SHIPPING.SCHEDULED_SHIPPING_DATE,'YYYY/MM/DD') SCHEDULED_SHIPPING_DATE -- 出荷年月日
        ,SHIPPING.TANTO_CD
        ,CASE WHEN 
                   ORDER_HEAD.ORDER_DIVISION = 3 	-- 仕入直送品の場合受注.納入予定日を表示しない
		      THEN 
			       NULL
		      ELSE 
			       TO_CHAR(ORDER_HEAD.DELIVERY_EXPECTED_DATE,'YYYY/MM/DD')
	     END AS DELIVERY_EXPECTED_DATE -- 到着指定日
        ,CASE WHEN 
                    ORDER_HEAD.ORDER_DIVISION = 3 	-- 仕入直送品の場合受注.納入時刻を表示しない
		      THEN 
			        NULL
		      ELSE 
			        ORDER_HEAD.DELIVERY_EXPECTED_TIME
	     END AS DELIVERY_EXPECTED_TIME-- 到着時間指定
        ,SHIPPING_DETAIL_LOCATION.UPPER_LOCATION_CD 
        ,LOC.LOCATION_NAME                          -- 出荷地
        ,SHIPPING.CARRY_CD
        ,CARRY.CARRY_NAME1
        ,CARRY.CARRY_NAME2                          -- 運送店
        ,NULL AS "REFERENCE" --参照
        ,ORDER_HEAD.CUSTOMER_ORDER_NO               -- 発注番号
        ,SHIPPING.ORDER_NO                          -- 受注番号
        ,SHIPPING.ORDER_ROW_NO
        ,SHIPPING.SHIPPING_STATUS
        , SHIPPING.ITEM_CD 
        ,SHIPPING.DELIVERY_COMP
        ,SHIPPING.SHIPPING_RESULT_DATE
        ,SHIPPING.SHIPPING_SLIP_NO
        ,SHIPPING.SHIPPING_SLIP_ROW_NO
        ,SHIPPING.SLIP_PUBLISH_COMP
        ,SHIPPING.SLIP_PUBLISH_DATE
        ,SHIPPING.SLIP_SHIPPING_ORDER_COMP
        ,SHIPPING.SLIP_SHIPPING_ORDER_DATE
        ,SHIPPING.SLIP_SHIPPING_SCHEDULE_COMP
        ,SHIPPING.SLIP_SHIPPING_SCHEDULE_DATE
        ,SHIPPING.SLIP_SHIPPING_TAG_COMP
        ,SHIPPING.SLIP_SHIPPING_TAG_DATE
        ,SHIPPING.SLIP_SHIPPING_REQUEST_COMP
        ,SHIPPING.SLIP_SHIPPING_REQUEST_DATE
        ,SHIPPING.SLIP_SHIPPING_FARE_COMP
        ,SHIPPING.SLIP_SHIPPING_FARE_DATE
        ,SHIPPING.SLIP_SHIPPING_DELIVELY_COMP
        ,SHIPPING.SLIP_SHIPPING_DELIVELY_DATE
        ,SHIPPING.SLIP_SHIPPING_NEW_TAG_COMP
        ,SHIPPING.SLIP_SHIPPING_NEW_TAG_DATE
        ,SHIPPING.SLIP_SHIPPING_POSTAL_COMP
        ,SHIPPING.SLIP_SHIPPING_POSTAL_DATE
        ,SHIPPING.SUGGESTED_DELIVERLIMIT
        ,SHIPPING.CARRY_FARE
        ,SHIPPING.SENDING_OFF_NUMBER
        ,SHIPPING.INPUT_DATE
        ,SHIPPING.INPUTOR_CD
        ,SHIPPING.UPDATE_DATE
        ,SHIPPING.UPDATOR_CD

        ,NULL AS FAX_NO --'0' || VENDER.SLIP_FAX_NO AS FAX_NO            --FAX番号
        ,NULL AS FAX_OUTPUT--VENDER.FAX_OUTPUT AS FAX_OUTPUT                --送信区分
        ,CARRY.REPOTR_OUTPUT_NUM
        ,ORDER_HEAD.PRINT_SUMMERY AS   PRINT_SUMMERY                     --備考(印字用)
        ,ORDER_HEAD.DELIVERY_SLIP_SUMMERY               --納品書備考
        ,ORDER_HEAD.ORDER_SUMMERY                       --受注時備考

        , TRIM( SHIPPING.CARRY_BC ) AS CARRY_BARCODE
        , CARRY.BC_PUBLISH_DIVISION
        , CARRY.BC_HEADER
        , CARRY.BC_FOOTER
        , CARRY.BC_NUMBER_OF_DIGIT
        , CARRY.BC_CHECKDIGIT_START
        , CARRY.BC_CHECKDIGIT_END

FROM    SHIPPING

LEFT JOIN (SELECT
					SHIPPING_DETAIL.SHIPPING_NO
				,	MAX(UPPER_LOCATION.UPPER_LOCATION_CD) AS UPPER_LOCATION_CD
                ,   SUM( SHIPPING_DETAIL.SHIPPING_INSTRUCTION ) AS SHIPPING_INSTRUCTION
				FROM
					SHIPPING_DETAIL
				,	(SELECT
						LOCA1.LOCATION_CD
					,	NVL(LOCA2.UPPER_LOCATION_CD,LOCA2.LOCATION_CD) AS UPPER_LOCATION_CD
					FROM
						LOCATION LOCA1
					,	LOCATION LOCA2
					WHERE
						NVL(LOCA1.UPPER_LOCATION_CD,LOCA1.LOCATION_CD) = LOCA2.LOCATION_CD(+)
					AND	(LOCA1.LOCATION_LEVEL = '1' OR LOCA1.LOCATION_LEVEL = '4')
					AND	LOCA1.LOCATION_CD <> 'K'
					)UPPER_LOCATION
				WHERE
					SHIPPING_DETAIL.LOCATION_CD = UPPER_LOCATION.LOCATION_CD
				
				GROUP BY
					SHIPPING_DETAIL.SHIPPING_NO
				)SHIPPING_DETAIL_LOCATION
ON        SHIPPING_DETAIL_LOCATION.SHIPPING_NO = SHIPPING.SHIPPING_NO

--LEFT JOIN SALES
--ON      SHIPPING.SHIPPING_NO = SALES.SHIPPING_NO
--AND     SHIPPING.ITEM_CD     = SALES.ITEM_CD

LEFT JOIN VENDER
ON        SHIPPING.VENDER_CD     = VENDER.VENDER_CD 
AND       VENDER.VENDER_DIVISION = 'TS'

LEFT JOIN DELIVERY
ON        SHIPPING.DELIVERY_CD   = DELIVERY.DELIVERY_CD

LEFT JOIN ORDER_HEAD
ON        SHIPPING.ORDER_NO      = ORDER_HEAD.ORDER_NO

LEFT JOIN LOCATION LOCATION
ON        SHIPPING_DETAIL_LOCATION.UPPER_LOCATION_CD = LOCATION.LOCATION_CD

LEFT JOIN LOCATION LOC
ON        LOC.LOCATION_CD = SHIPPING_DETAIL_LOCATION.UPPER_LOCATION_CD

LEFT JOIN CARRY
ON        SHIPPING.CARRY_CD = CARRY.CARRY_CD

LEFT JOIN ITEM
ON        SHIPPING.ITEM_CD = ITEM.ITEM_CD


 
 
/
COMMENT ON TABLE REP_SLIP_SHIPPING_DEL_HEADER IS 'REP_納品伝票ヘッダ'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.KEY IS 'キー'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SHIPPING_NO IS '出荷番号'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.CATEGORY_DIVISION IS '分類コード'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.VENDER_CD IS '得意先コード'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.VENDER_NAME IS 'お得意先名'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.DELIVERY_NAME_ALL IS 'お届先名'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.DELIVERY_ADDRESS_ALL IS 'お届先住所'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.DELIVERY_TEL_NO IS 'ＴＥＬ'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.DELIVERY_CD IS '届先コード'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SHIPPING_INSTRUCT_DATE IS '出荷指図日'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SCHEDULED_SHIPPING_DATE IS '出荷年月日'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.TANTO_CD IS '出荷担当者コード'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.DELIVERY_EXPECTED_DATE IS '到着指定日'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.DELIVERY_EXPECTED_TIME IS '到着時間指定'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.UPPER_LOCATION_CD IS '出荷地コード'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.LOCATION_NAME IS '出荷地名称'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.CARRY_CD IS '運送会社コード'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.CARRY_NAME1 IS '運送会社1'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.CARRY_NAME2 IS '運送会社2'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.REFERENCE IS '参照'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.CUSTOMER_ORDER_NO IS '受注番号'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.ORDER_NO IS '発注番号'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.ORDER_ROW_NO IS '行番号(受注)'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SHIPPING_STATUS IS '出荷ステータス|1:出荷指図未確定 2:出荷指図確定済 3:指図送信済 4:実績受信中 5:出荷完了'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.ITEM_CD IS '品目コード'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.DELIVERY_COMP IS '完納区分'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SHIPPING_RESULT_DATE IS '出荷完了日'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SHIPPING_SLIP_NO IS '出荷伝票番号'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SHIPPING_SLIP_ROW_NO IS '出荷伝票行番号'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_PUBLISH_COMP IS '出荷伝票発行済区分(0:未発行 1:発行済)'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_PUBLISH_DATE IS '伝票発行日'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_ORDER_COMP IS '出荷指図書発行済区分(0:未発行 1:発行済)'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_ORDER_DATE IS '出荷指図書発行日'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_SCHEDULE_COMP IS '出荷予定表発行済区分(0:未発行 1:発行済)'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_SCHEDULE_DATE IS '出荷予定表発行日'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_TAG_COMP IS '荷札,ペリカン発行済区分(0:未発行 1:発行済)'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_TAG_DATE IS '荷札,ペリカン発行日'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_REQUEST_COMP IS '出荷依頼書発行済区分(0:未発行 1:発行済)'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_REQUEST_DATE IS '出荷依頼書発行日'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_FARE_COMP IS '運賃表発行済区分(0:未発行 1:発行済)'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_FARE_DATE IS '運賃表発行日'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_DELIVELY_COMP IS '納品伝票発行済区分(0:未発行 1:発行済)'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_DELIVELY_DATE IS '納品伝票発行日'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_NEW_TAG_COMP IS '新荷札発行済区分(0:未発行 1:発行済)'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_NEW_TAG_DATE IS '新荷札発行日'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_POSTAL_COMP IS '新郵政発行済区分(0:未発行 1:発行済)'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SLIP_SHIPPING_POSTAL_DATE IS '新郵政発行日'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SUGGESTED_DELIVERLIMIT IS '希望納期'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.CARRY_FARE IS '運賃'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.SENDING_OFF_NUMBER IS '積出ナンバー'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.INPUT_DATE IS '登録日時'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.INPUTOR_CD IS '登録者ID'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.UPDATE_DATE IS '更新日時'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.UPDATOR_CD IS '更新者ID'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.FAX_NO IS 'FAX番号(未使用)'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.FAX_OUTPUT IS '送信区分(未使用)'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.REPOTR_OUTPUT_NUM IS '帳票出力用番号'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.PRINT_SUMMERY IS '備考(印字用)'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.DELIVERY_SLIP_SUMMERY IS '納品書備考'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.ORDER_SUMMERY IS '受注時備考'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.CARRY_BARCODE IS '出荷バーコード※StartStopBit(*)は出力時に付与すること。'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.BC_PUBLISH_DIVISION IS 'バーコード発行区分'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.BC_HEADER IS 'バーコードヘッダ'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.BC_FOOTER IS 'バーコードフッタ'
/
COMMENT ON COLUMN REP_SLIP_SHIPPING_DEL_HEADER.BC_NUMBER_OF_DIGIT IS 'バーコード桁数'
/

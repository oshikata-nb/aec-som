CREATE OR REPLACE VIEW AP21.SIAP_CAY1
    (Y1COCODE,Y1HBRCODE,Y1GBUMONCD,Y1KOTEICD,Y1KNAME,Y1KAKOUKBN,Y1KOTEISKBN,
    Y1STARTDATE,Y1ENDDATE)
AS
SELECT '001'                                  AS Y1COCODE,    -- 会社コード
       '001'                                  AS Y1HBRCODE,   -- 本支店コード
       SECT.ACCOUNT_CD                        AS Y1GBUMONCD,  -- 原価部門コード
       OPER.OPERATION_GROUP_CD                AS Y1KOTEICD,   -- 工程コード
       substr(OPER.OPERATION_GROUP_NAME,1,20) AS Y1KNAME,     -- 工程名称(20)
       3                                      AS Y1KAKOUKBN,  -- 製造間接費配賦基準(0:直接作業時間)
       0                                      AS Y1KOTEISKBN, -- 工程種別(0:人員 1:設備)
       to_char(RCPH.START_DATE,'YYYYMMDD')    AS Y1STARTDATE, -- 有効開始日
       to_char(RCPH.END_DATE,'YYYYMMDD')      AS Y1ENDDATE    -- 有効終了日
  FROM AP21.OPERATION_GROUP OPER,
       (SELECT RECIPE_USE,
               SECTION_CD,
               min(START_DATE) AS START_DATE,
               max(END_DATE)   AS END_DATE
          FROM AP21.RECIPE_HEADER
         WHERE RECIPE_TYPE = 3               -- 3:基本処方
           AND APPROVAL_STATUS = 3           -- 3:承認済み
           AND RECIPE_STATUS in (2,3)        -- 2:試作用,3:一般使用
        GROUP BY RECIPE_USE,SECTION_CD
       ) RCPH,
       AP21.BUMON SECT
 WHERE OPER.OPERATION_GROUP_CD in (10,30)
   AND DECODE(RCPH.RECIPE_USE,3,10,4,30) = OPER.OPERATION_GROUP_CD
   AND RCPH.SECTION_CD = SECT.SECTION_CD
 ORDER BY Y1GBUMONCD,Y1KOTEICD,Y1STARTDATE
/
COMMENT ON TABLE AP21.SIAP_CAY1 IS 'ＣＡ工程マスタ'
/
COMMENT ON COLUMN AP21.SIAP_CAY1.Y1COCODE IS '会社コード'
/
COMMENT ON COLUMN AP21.SIAP_CAY1.Y1HBRCODE IS '本支店コード'
/
COMMENT ON COLUMN AP21.SIAP_CAY1.Y1GBUMONCD IS '原価部門コード'
/
COMMENT ON COLUMN AP21.SIAP_CAY1.Y1KOTEICD IS '工程コード'
/
COMMENT ON COLUMN AP21.SIAP_CAY1.Y1KNAME IS '工程名称'
/
COMMENT ON COLUMN AP21.SIAP_CAY1.Y1KAKOUKBN IS '製造間接費配賦基準(0:直接作業時間)'
/
COMMENT ON COLUMN AP21.SIAP_CAY1.Y1KOTEISKBN IS '工程種別(0:人員 1:設備)'
/
COMMENT ON COLUMN AP21.SIAP_CAY1.Y1STARTDATE IS '有効開始日'
/
COMMENT ON COLUMN AP21.SIAP_CAY1.Y1ENDDATE IS '有効終了日'
/

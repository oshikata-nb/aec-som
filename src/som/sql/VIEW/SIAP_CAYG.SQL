CREATE OR REPLACE VIEW AP21.SIAP_CAYG
    (YGCOCODE,YGHBRCODE,YGIMCODE,YGNODATE,YGACNO,YGACHOJO,YGZGZENSU,YGZGSTTANK,
    YGZGJSSTTANK,YGZGSTKIN,YGZGJSSTKIN,YGZGINQTY,YGZGINTANK,YGZGINKING,
    YGZGJSINTANK,YGZGJSINKING,YGZGOTQTY,YGZGOTTANK,YGZGOTKING,YGZGJSOTTANK,
    YGZGJSOTKING,YGZGKURISU,YGZGENTANK,YGZGJSENTANK,YGZGENKIN,YGZGJSENKIN)
AS
SELECT '001' AS YGCOCODE -- 会社コード( ◎ ※共通仕様参照。)
	  ,'001' AS YGHBRCODE -- 本支店コード(※共通仕様参照。)
	  ,MONTHLY.ITEM_CD AS YGIMCODE -- 品目コード(20桁以内)
	  ,MONTHLY.TARGET_MONTH AS YGNODATE -- 処理年月度(YYYYMM)
	  ,NULL AS YGACNO -- 勘定科目コード(未使用 NULL)
	  ,NULL AS YYGACHOJO -- 補助科目コード(未使用 NULL)
	   --      ,SUM(NVL(MONTHLY.LM_INVENTORY_QTY, 0)) AS YGZGZENSU -- 前月繰越在庫数
	  ,CASE MAX(ITEM.TYPE_DIVISION)
		   WHEN 0 THEN -- 製品
		   -- 要換算
			SUM(NVL(MONTHLY.LM_INVENTORY_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0))
		   WHEN 4 THEN -- 仕入直送品
			0
		   WHEN 5 THEN -- 仕入在庫品
		   -- 要換算
			SUM(NVL(MONTHLY.LM_INVENTORY_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0))
		   WHEN 6 THEN -- 外注品(直送)
		   -- 要換算
			SUM(NVL(MONTHLY.LM_INVENTORY_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0))
		   WHEN 7 THEN -- 外注品(非直送)
		   -- 要換算
			SUM(NVL(MONTHLY.LM_INVENTORY_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0))
		   ELSE
		   -- 換算不要
			SUM(NVL(MONTHLY.LM_INVENTORY_QTY, 0))
	   END YGZGZENSU -- 前月繰越在庫数
	   
	  ,0 AS YYGZGSTTANK -- 前月繰越在庫評価単価<予定>(未使用 0)
	   --      ,SUM(NVL(MONTHLY.LM_INVENTORY_COST, 0)) AS YGZGJSSTTANK -- 前月繰越在庫評価単価<実際>
	  ,CASE MAX(ITEM.TYPE_DIVISION)
		   WHEN 0 THEN -- 製品
		   -- 要換算
			SUM(NVL(MONTHLY.LM_INVENTORY_COST, 0) / DECODE(NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0), 0, 1, NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 1)))
		   WHEN 4 THEN -- 仕入直送品
		   -- 要換算
			SUM(NVL(MONTHLY.LM_INVENTORY_COST, 0) / DECODE(NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0), 0, 1, NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 1)))
		   WHEN 5 THEN -- 仕入在庫品
		   -- 要換算
			SUM(NVL(MONTHLY.LM_INVENTORY_COST, 0) / DECODE(NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0), 0, 1, NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 1)))
		   WHEN 6 THEN -- 外注品(直送)
		   -- 要換算
			SUM(NVL(MONTHLY.LM_INVENTORY_COST, 0) / DECODE(NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0), 0, 1, NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 1)))
		   WHEN 7 THEN -- 外注品(非直送)
		   -- 要換算
			SUM(NVL(MONTHLY.LM_INVENTORY_COST, 0) / DECODE(NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0), 0, 1, NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 1)))
		   ELSE
		   -- 換算不要
			SUM(NVL(MONTHLY.LM_INVENTORY_COST, 0))
	   END YGZGJSSTTANK -- 前月繰越在庫評価単価<実際>
	   
	  ,0 AS YGZGSTKIN -- 前月繰越在庫金額<予定>(未使用 0)
	  ,SUM(NVL(MONTHLY.LM_INVENTORY_AMOUNT, 0)) AS YGZGJSSTKIN -- 前月繰越在庫金額<実際>
	   --      ,SUM(NVL(MONTHLY.IN_QTY, 0)) AS YGZGINQTY -- 当月入庫数
	  ,CASE MAX(ITEM.TYPE_DIVISION)
		   WHEN 0 THEN -- 製品
		   -- 要換算
			SUM(NVL(MONTHLY.IN_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0))
		   WHEN 4 THEN -- 仕入直送品
		   -- 要換算
			SUM(NVL(MONTHLY.IN_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0))
		   WHEN 5 THEN -- 仕入在庫品
		   -- 要換算
			SUM(NVL(MONTHLY.IN_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0))
		   WHEN 6 THEN -- 外注品(直送)
		   -- 要換算
			SUM(NVL(MONTHLY.IN_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0))
		   WHEN 7 THEN -- 外注品(非直送)
		   -- 要換算
			SUM(NVL(MONTHLY.IN_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0))
		   ELSE
		   -- 換算不要
			SUM(NVL(MONTHLY.IN_QTY, 0))
	   END YGZGINQTY -- 当月入庫数
	   
	  ,0 AS YGZGINTANK -- 当月入庫単価<予定>(未使用 0)
	  ,0 AS YGZGINKING -- 当月入庫金額<予定>(未使用 0)
	  ,0 AS YGZGJSINTANK -- 当月入庫単価<実際>(未使用 0)
	  ,SUM(NVL(MONTHLY.IN_AMOUNT, 0)) AS YGZGJSINKING -- 当月入庫金額<実際>
	   --      ,SUM(NVL(MONTHLY.OUT_QTY, 0)) * -1 AS YGZGOTQTY -- 当月出庫数
	  ,CASE MAX(ITEM.TYPE_DIVISION)
		   WHEN 0 THEN -- 製品
		   -- 要換算
			SUM(NVL(MONTHLY.OUT_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0)) * -1
		   WHEN 4 THEN -- 仕入直送品
		   -- 要換算
			SUM(NVL(MONTHLY.IN_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0))
		   WHEN 5 THEN -- 仕入在庫品
		   -- 要換算
			SUM(NVL(MONTHLY.OUT_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0)) * -1
		   WHEN 6 THEN -- 外注品(直送)
		   -- 要換算
			SUM(NVL(MONTHLY.OUT_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0)) * -1
		   WHEN 7 THEN -- 外注品(非直送)
		   -- 要換算
			SUM(NVL(MONTHLY.OUT_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0)) * -1
		   ELSE
		   -- 換算不要
			SUM(NVL(MONTHLY.OUT_QTY, 0)) * -1
	   END YGZGOTQTY -- 当月出庫数
	   
	  ,0 AS YGZGOTTANK -- 当月出庫単価<予定>:';
	  ,0 AS YGZGOTKING -- 当月出庫金額<予定>:';
	  ,0 AS YGZGJSOTTANK -- 当月出庫単価<実際>:';
	  ,0 AS YGZGJSOTKING -- 当月出庫金額<実際>:';
	   --      ,SUM(NVL(MONTHLY.NM_INVENTORY_QTY, 0)) AS YGZGKURISU -- 翌月繰越在庫数:';
	  ,CASE MAX(ITEM.TYPE_DIVISION)
		   WHEN 0 THEN -- 製品
		   -- 要換算
			SUM(NVL(MONTHLY.NM_INVENTORY_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0))
		   WHEN 4 THEN -- 仕入直送品
			0
		   WHEN 5 THEN -- 仕入在庫品
		   -- 要換算
			SUM(NVL(MONTHLY.NM_INVENTORY_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0))
		   WHEN 6 THEN -- 外注品(直送)
		   -- 要換算
			SUM(NVL(MONTHLY.NM_INVENTORY_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0))
		   WHEN 7 THEN -- 外注品(非直送)
		   -- 要換算
			SUM(NVL(MONTHLY.NM_INVENTORY_QTY, 0) * NVL(ITEM.KG_OF_FRACTION_MANAGEMENT, 0))
		   ELSE
		   -- 換算不要
			SUM(NVL(MONTHLY.NM_INVENTORY_QTY, 0))
	   END YGZGKURISU -- 翌月繰越在庫数:';
	   
	  ,0 AS YGZGENTANK -- 翌月繰越在庫評価単価<予定>:';
	  ,0 AS YGZGJSENTANK -- 翌月繰越在庫評価単価<実際>:';
	  ,0 AS YGZGENKIN -- 翌月繰越在庫金額<予定>:';
	  ,0 AS YGZGJSENKIN -- 翌月繰越在庫金額<実際>:';
FROM   AP21.MONTHLY_INOUT_RECORD MONTHLY
	  ,AP21.ITEM
WHERE  MONTHLY.LOCATION_CD IN (SELECT LOCATION_CD
							   FROM   AP21.LOCATION
							   WHERE  STOCK_DIVISION IN (1, 3) -- 1:通常 3:在庫引当対象外
							   AND    AVAILABLE_FLG = 1)
	  --AND    ITEM.TYPE_DIVISION <> 4 -- 仕入直送品以外
	  --AND    (ITEM.SHIPPER_DIVISION <> 3 -- 油脂以外
	  --      OR ITEM.TYPE_DIVISION <> 6) -- 外注品(直送)以外
	  --AND    ITEM.TYPE_DIVISION <> 4 -- 仕入直送品以外
AND    ITEM.TYPE_DIVISION <> 9 -- その他以外
	  --AND    (ITEM.SHIPPER_DIVISION <> 3 -- 油脂以外
	  --      OR ITEM.TYPE_DIVISION <> 6) -- 外注品(直送)以外
AND    ITEM.SHIPPER_DIVISION <> 3 -- 油脂以外
AND    MONTHLY.ITEM_CD = ITEM.ITEM_CD
GROUP  BY MONTHLY.ITEM_CD
		 ,MONTHLY.TARGET_MONTH
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGCOCODE IS '会社コード( ◎ ※共通仕様参照。)'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGHBRCODE IS '本支店コード(※共通仕様参照。)'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGIMCODE IS '品目コード(20桁以内)'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGNODATE IS '処理年月度(YYYYMM)'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGACNO IS '勘定科目コード(未使用 NULL)'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGACHOJO IS '補助科目コード(未使用 NULL)'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGZENSU IS '前月繰越在庫数'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGSTTANK IS '前月繰越在庫評価単価<予定>(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGJSSTTANK IS '前月繰越在庫評価単価<実際> (未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGSTKIN IS '前月繰越在庫金額<予定>(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGJSSTKIN IS '前月繰越在庫金額<実際>(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGINQTY IS '当月入庫数'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGINTANK IS '当月入庫単価<予定>(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGINKING IS '当月入庫金額<予定>(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGJSINTANK IS '当月入庫単価<実際>(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGJSINKING IS '当月入庫金額<実際>(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGOTQTY IS '当月出庫数'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGOTTANK IS '当月出庫単価<予定>:'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGOTKING IS '当月出庫金額<予定>:'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGJSOTTANK IS '当月出庫単価<実際>:'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGJSOTKING IS '当月出庫金額<実際>:'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGKURISU IS '翌月繰越在庫数:'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGENTANK IS '翌月繰越在庫評価単価<予定>:'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGJSENTANK IS '翌月繰越在庫評価単価<実際>:'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGENKIN IS '翌月繰越在庫金額<予定>:'
/
COMMENT ON COLUMN AP21.SIAP_CAYG.YGZGJSENKIN IS '翌月繰越在庫金額<実際>:'
/

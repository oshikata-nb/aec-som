CREATE OR REPLACE VIEW AP21.SIAP_CAYB
    (YBCOCODE,YBHBRCODE,YBKESANKI,YBKGETSUDO,YBSGDENNO,YBWJSGDT,YBGYOBAN,
    YBTACODE,YBGBUMONCD,YBACTCD,YBCKHIKBN,YBKSEQNO,YBKOTEICD,YBSETUCD,YBSSODR,
    YBIMCODE,YBKNBUNKB,YBACNO,YBACHOJO,YBKAKOUKBN,YBWJINQTY,YBSTJDAY,YBSTJTIM,
    YBEDDAY,YBEDTIM,YBRMSAJIKAN,YBRMSAJIKANH,YBWJNINZU,YBKISTDAY,YBKISTTIM,
    YBKIEDDAY,YBKIEDTIM,YBRMKIJIKAN,YBRMKIJIKANH,YBYCHINRITSU,YBJCHINRITSU,
    YBYCHINGIN,YBJCHINGIN,YBHKTANK,YBSTRKIN,YBSPHCMT,YBSDENNO,YBSGYONO,
    YBSDENCRDT,YBKTBUNKB,YBKNMOVEFLG,YBKNMOVECMT,YBPROJECTCD)
AS
SELECT '001' AS YBCOCODE -- 会社コード( ◎ ※共通仕様参照。)
	  ,'001' AS YBHBRCODE -- 本支店コード(※共通仕様参照。)
	  ,'000' AS YBKESANKI -- 決算期(※共通仕様参照。)
	  ,0 AS YBKGETSUDO -- 会計月度(未使用 0)
	  ,DREP.SLIP_NO AS YBSGDENNO -- 作業伝票番号(生産ライン＋製造日＋担当区分＋担当者コード）
	  ,DREP.PRODUCTION_DATE AS YBWJSGDT -- 作業日(YYYYMMDD)
	  ,DREP.ROW_NO AS YBGYOBAN -- 行番号
	  ,SUBSTRB(DREP.TANTO_CD, 1, 6) AS YBTACODE -- 担当者コード
	  ,DREP.ACCOUNT_CD AS YBGBUMONCD -- 原価部門コード
	  ,NULL AS YBACTCD -- 活動コード(未使用 NULL)
	  ,DREP.JOB_DIVISION AS YBCKHIKBN -- 直接費・間接費区分(0..直接費 1..間接費)
	  ,DECODE(DREP.DIRECTION_DIVISION, 1, 10, 2, 30, 3, 30, 99) AS YBKSEQNO -- 工程順序
	  ,DECODE(DREP.DIRECTION_DIVISION, 1, '10', 2, '30', 3, '30', '99') AS YBKOTEICD -- 工程コード
	  ,NULL AS YBSETUCD -- 設備コード(未使用 NULL)
	  ,DREP.DIRECTION_NO AS YBSSODR -- 製造オーダー番号
	  ,DREP.ITEM_CD AS YBIMCODE -- 品目コード(20桁以内)
	  ,1 AS YBKNBUNKB -- 機能別分類
	  ,'01200' AS YBACNO -- 勘定科目コード
	  ,'0000000000' AS YBACHOJO -- 補助科目コード('0000000000')
	  ,0 AS YBKAKOUKBN -- 加工時間種別(0:直接作業時間 1:機械作業時間)
	  ,0 AS YBWJINQTY -- 製造数量(未使用 0)
	  ,0 AS YBSTJDAY -- 作業開始日(未使用 0)
	  ,0 AS YBSTJTIM -- 作業開始時刻(未使用 0)
	  ,0 AS YBEDDAY -- 作業終了日(未使用 0)
	  ,0 AS YBEDTIM -- 作業終了時刻(未使用 0)
	  ,DREP.JOB_TIME * 60 AS YBRMSAJIKAN -- 作業時間(分)
	  ,DREP.JOB_TIME AS YBRMSAJIKANH -- 作業時間（H) 
	  ,0 AS YBWJNINZU -- 作業人数(未使用 0)
	  ,0 AS YBKISTDAY -- 稼動開始日(未使用 0)
	  ,0 AS YBKISTTIM -- 稼動開始時刻(未使用 0)
	  ,0 AS YBKIEDDAY -- 稼動終了日(未使用 0)
	  ,0 AS YBKIEDTIM -- 稼動終了時刻(未使用 0)
	  ,0 AS YBRMKIJIKAN -- 稼動時間(分)
	  ,0 AS YBRMKIJIKANH -- 稼動時間(H) 
	  ,0 AS YBYCHINRITSU -- 予定賃率(未使用 0)
	  ,0 AS YBJCHINRITSU -- 実際賃率(未使用 0)
	  ,0 AS YBYCHINGIN -- 賃金予定額(未使用 0)
	  ,0 AS YBJCHINGIN -- 賃金実際額(未使用 0)
	  ,0 AS YBHKTANK -- 標準加工費単価(未使用 0)
	  ,0 AS YBSTRKIN -- 実際仕入金額(未使用 0)
	  ,NULL AS YBSPHCMT -- 摘要(未使用 NULL)
	  ,NULL AS YBSDENNO -- 仕訳伝票番号(未使用 NULL)
	  ,0 AS YBSGYONO -- 仕訳伝票行番号(未使用 0)
	  ,0 AS YBSDENCRDT -- 仕訳伝票作成日(未使用 0)
	  ,DREP.COST_ACCOUNTS AS YBKTBUNKB -- 形態別分類(0..その他 1..材料費 2..労務費 3..経費 4..外注加工費)
	  ,0 AS YBKNMOVEFLG -- 間接費移動フラグ(未使用 0)
	  ,NULL AS YBKNMOVECMT -- 間接費移動摘要(未使用 NULL)
	  ,NULL AS YBPROJECTCD -- プロジェクトコード(未使用 NULL)
FROM   (
		-- 直接作業時間を作業日報から取得
		SELECT REPT.TANTO_CD AS TANTO_CD
			   ,REPT.PRODUCTION_LINE ||
				TO_CHAR(REPT.PRODUCTION_DATE, 'YYYYMMDD') ||
				REPT.TANTO_DIVISION || REPT.TANTO_CD AS SLIP_NO -- 伝票番号(生産ライン＋製造日＋担当区分＋担当者コード）
			   ,TO_NUMBER(TO_CHAR(REPT.PRODUCTION_DATE, 'YYYYMMDD')) AS PRODUCTION_DATE
			   ,ROW_NUMBER() OVER(PARTITION BY REPT.PRODUCTION_LINE, REPT.PRODUCTION_DATE, REPT.TANTO_DIVISION, REPT.TANTO_CD ORDER BY REPT.DIRECTION_NO) AS ROW_NO
			   ,TO_CHAR(NVL(SECT.ACCOUNT_CD, '9999')) AS ACCOUNT_CD -- 原価部門コード
			   ,0 AS JOB_DIVISION -- 作業区分(0..直接費 1..間接費)
			   ,DIRH.DIRECTION_DIVISION AS DIRECTION_DIVISION
			   ,TO_CHAR(REPT.DIRECTION_NO) AS DIRECTION_NO -- 指図書番号
			   ,TO_CHAR(DIRH.ITEM_CD) AS ITEM_CD -- 品目コード(20桁以内)
			   ,REPT.JOB_TIME AS JOB_TIME -- 直接作業時間
			   ,DECODE(REPT.TANTO_DIVISION, 1, 2, 3) AS COST_ACCOUNTS -- 原価項目(担当者区分が1:社員→2..労務費、その他→3..経費)
		FROM   AP21.DAILY_REPORT     REPT -- 作業日報
			   ,AP21.DIRECTION_HEADER DIRH -- 製造指図（ヘッダ）
			   ,AP21.RECIPE_HEADER    RCPH -- 基本処方（ヘッダ）
			   ,AP21.BUMON            SECT -- 部門マスタ
		WHERE  REPT.DIRECTION_NO = DIRH.DIRECTION_NO
		AND    DIRH.RECIPE_ID = RCPH.RECIPE_ID
		AND    RCPH.RECIPE_TYPE = 3 -- 3:基本処方
		AND    RCPH.RECIPE_USE IN (3, 4) -- 3:製造,4:包装
			  --      AND    RCPH.APPROVAL_STATUS = 3 -- 3:承認済み
		AND    REPT.JOB_TIME > 0 -- 作業時間>0
		AND    RCPH.SECTION_CD(+) = SECT.SECTION_CD) DREP
ORDER  BY YBSGDENNO, YBGYOBAN
/
COMMENT ON TABLE AP21.SIAP_CAYB IS 'ＣＡ作業日報ファイル'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBCOCODE IS '会社コード(※共通仕様参照)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBHBRCODE IS '本支店コード(※共通仕様参照。)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBKESANKI IS '決算期(※共通仕様参照。)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBKGETSUDO IS '会計月度(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBSGDENNO IS '作業伝票番号(生産ライン＋製造日＋担当区分＋担当者コード）'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBWJSGDT IS '作業日(YYYYMMDD)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBGYOBAN IS '行番号'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBTACODE IS '担当者コード(未使用 NULL)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBGBUMONCD IS '原価部門コード'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBACTCD IS '活動コード(未使用 NULL)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBCKHIKBN IS '直接費・間接費区分(0..直接費 1..間接費)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBKSEQNO IS '工程順序'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBKOTEICD IS '工程コード'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBSETUCD IS '設備コード(未使用 NULL)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBSSODR IS '製造オーダー番号'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBIMCODE IS '品目コード(20桁以内)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBKNBUNKB IS '機能別分類(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBACNO IS '勘定科目コード'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBACHOJO IS '補助科目コード(0000000000)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBKAKOUKBN IS '加工時間種別(0:直接作業時間 1:機械作業時間)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBWJINQTY IS '製造数量(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBSTJDAY IS '作業開始日(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBSTJTIM IS '作業開始時刻(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBEDDAY IS '作業終了日(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBEDTIM IS '作業終了時刻(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBRMSAJIKAN IS '作業時間(分)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBRMSAJIKANH IS '作業時間（H) '
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBWJNINZU IS '作業人数(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBKISTDAY IS '稼動開始日(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBKISTTIM IS '稼動開始時刻(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBKIEDDAY IS '稼動終了日(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBKIEDTIM IS '稼動終了時刻(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBRMKIJIKAN IS '稼動時間(分)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBRMKIJIKANH IS '稼動時間(H) '
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBYCHINRITSU IS '予定賃率(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBJCHINRITSU IS '実際賃率(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBYCHINGIN IS '賃金予定額(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBJCHINGIN IS '賃金実際額(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBHKTANK IS '標準加工費単価(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBSTRKIN IS '実際仕入金額(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBSPHCMT IS '摘要(未使用 NULL)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBSDENNO IS '仕訳伝票番号(未使用 NULL)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBSGYONO IS '仕訳伝票行番号(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBSDENCRDT IS '仕訳伝票作成日(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBKTBUNKB IS '形態別分類(0..その他 1..材料費 2..労務費 3..経費 4..外注加工費)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBKNMOVEFLG IS '間接費移動フラグ(未使用 0)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBKNMOVECMT IS '間接費移動摘要(未使用 NULL)'
/
COMMENT ON COLUMN AP21.SIAP_CAYB.YBPROJECTCD IS 'プロジェクトコード(未使用 NULL)'
/
